<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="icon" type="image/x-icon" href="/assets/CustomTranslate_Logo.jpg">
    <title>Custom Translate</title>
  </head>
  <body>
    <header>
      <nav>
        <img src="/assets/CustomTranslate_Logo.jpg" width="50px">
      </nav>
    </header>
    <main id="setupContainer">
      <aside id="instructions">
        <h1>Custom Translate</h1>
        <p id="subtitle">
          Welcome to Custom Translate! To get started:
        </p>
        <ol>
          <li>
            Type in a language you're learning
          </li>
          <li>
            Select a <a class="inline" href="https://www.coe.int/en/web/common-european-framework-reference-languages/level-descriptions">CEFR language level</a>
          </li>
          <li>
            Write or paste some text!
          </li>
        </ol>
        <p>
          It's as easy as three simple steps! Custom Translate uses the power of AI to recognize and translate your specific dialect, so you don't need to specify the starting language.
        </p>
      </aside>
      <!-- TODO: don't use form? Disable page refresh in form [action attribute -> url that it should be posted to] -->
      <section id="inputForm" autocomplete="on">
        <label for="outputLanguage">Type a language to translate to:</label>
        <input id="outputLanguage" type="text" placeholder="any language" />
        <label for="langLevel">What is your CEFR language learning level?</label>
        <select id="langLevel" name="select CEFR level">
          <option value="a1">A1: Beginner</option>
          <option value="a2">A2: Pre-Intermediate</option>
          <option value="b1">B1: Intermediate</option>
          <option value="b2">B2: Upper-Intermediate</option>
          <option value="c1">C1: Advanced</option>
          <option value="c2">C2: Proficiency</option>
        </select>
        <label for="inputText">Text to translate:</label>
        <textarea id="inputText" placeholder="Esse quia molestiae consectetur et accusantium explicabo id. Illo deserunt nihil facilis modi. At sapiente aliquam quos. Dolore iste eum alias cumque nisi aliquam dolorum beatae. Ea nulla eos ad quis ratione quasi unde. Quasi voluptas in quia veritatis."></textarea>
      </section>
      <button id="translate">Translate!</button>
      <section id="textOutput">
        <label for="outputParagraph">Translated Text:</label>
        <p id="outputParagraph"></p>
      </section>
    </main>
    <footer>
      <p>
        Custom Translate, a tool designed by Shayla Lee, 2024.
      </p>
    </footer>
    <script>
      // Declare variables to reference each element that receives user input
      const outputLanguageElement = document.getElementById("outputLanguage");
      const langLevelElement = document.getElementById("langLevel");
      const inputTextElement = document.getElementById("inputText");
      const translateButton = document.getElementById("translate");

      translateButton.addEventListener("click", () => {
        // Reference the current values of the input fields and convert to URI components for the url
        const langLevel = encodeURIComponent(langLevelElement[langLevelElement.selectedIndex].firstChild.data);
        const outputLanguage = encodeURIComponent(outputLanguageElement.value);
        const inputText = encodeURIComponent(inputTextElement.value);

        fetch(`/api/gpt?outputLanguage=${outputLanguage}&langLevel=${langLevel}&inputText=${inputText}`, 
              // {method: "POST"}
              )
          .then((response) => response.text())
          .then((responseText) => {
            const outputParagraph = document.getElementById("outputParagraph");
            console.log(`Response text: ${responseText}`);
            outputParagraph.innerText = responseText;
          })
          .catch((error) => {
            console.error('Fetch error:', error);
          });
      });
    </script>
  </body>
</html>
